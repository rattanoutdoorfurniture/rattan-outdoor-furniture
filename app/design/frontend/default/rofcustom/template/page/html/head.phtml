
<!-- Basic Page Needs
================================================== -->
<meta http-equiv="Content-Type" content="<?php echo $this->getContentType() ?>" />
<title><?php echo $this->getTitle() ?></title>
<meta name="description" content="<?php echo htmlspecialchars($this->getDescription()) ?>" />
<meta name="keywords" content="<?php echo htmlspecialchars($this->getKeywords()) ?>" />
<meta name="robots" content="<?php echo htmlspecialchars($this->getRobots()) ?>" />
<meta name="author" content="https://plus.google.com/105588355789811411119">
<meta name="google-site-verification" content="FZDC31mGIrSoBbOqM8oSp6RrVMZA5IgzITFazM8x3xE" />

<!-- Facebook Open Graph Metas
================================================== -->
    <!-- Facebook global meta  -->
    <meta property="og:site_name" content="<?php echo $this->__("Rattan Outdoor Furniture"); ?>"/>
<?php if (Mage::registry('current_product')) : ?>
    <!-- Facebook product meta -->
    <meta property="og:title" content="<?php echo Mage::registry('current_product')->getShortDescription()." ".Mage::registry('current_product')->getName() ." by Rattan Outdoor Furniture" ?>" />
    <meta property="og:description" content="<?php echo strip_tags(Mage::registry('current_product')->getMetaDescription()); ?>" />
    <meta property="og:image" content="<?php echo Mage::helper('catalog/image')->init(Mage::registry('current_product'), 'image')->resize(200,200);?>" />
    <meta property="og:url" content="<?php echo Mage::registry('current_product')->getProductUrl(); ?>" />
<?php else: ?>
    <!-- Facebook general meta -->
    <meta property="og:title" content="<?php echo $this->getTitle(); ?>" />
    <meta property="og:url" content="<?php echo $this->getUrl(); ?>" />
    <meta property="og:image" content="<?php echo str_replace("-left-","-centered-",$this->getSkinUrl(Mage::getStoreConfig('design/header/logo_src'))); ?>" />
    <meta property="og:description" content="<?php echo $this->getDescription(); ?>" />

<?php endif; ?>

<!-- Mobile Specific Metas
================================================== -->
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<!-- Favicons
================================================== -->
<link rel="icon" href="<?php echo $this->getFaviconFile(); ?>" type="image/x-icon" />
<?php if($this->getFaviconFile()): ?>
<link rel="shortcut icon" href="<?php echo $this->getFaviconFile(); ?>" type="image/x-icon" />
<?php else: ?>
<link rel="shortcut icon" href="/skin/frontend/default/rofcustom/images/favicon.ico">
<?php endif; ?>
<link rel="apple-touch-icon" href="/skin/frontend/default/rofcustom/images/apple/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="72x72" href="/skin/frontend/default/rofcustom/images/apple/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="114x114" href="/skin/frontend/default/rofcustom/images/apple/apple-touch-icon-114x114.png">


<!--[if lt IE 9]>
<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
<?php echo $this->getCssJsHtml() ?>
<?php echo $this->getChildHtml() ?>
<?php echo $this->helper('core/js')->getTranslatorScript() ?>
<?php echo $this->getIncludes() ?>


<?php
$actionName = $this->getAction()->getFullActionName();
if ($actionName == 'catalog_category_view') // Category Page
{
    $category = Mage::registry('current_category');
    $prodCol = $category->getProductCollection()->addAttributeToFilter('status', 1)->addAttributeToFilter('visibility', array('in' => array(Mage_Catalog_Model_Product_Visibility::VISIBILITY_IN_CATALOG, Mage_Catalog_Model_Product_Visibility::VISIBILITY_BOTH)));
    $tool = $this->getLayout()->createBlock('page/html_pager')->setLimit($this->getLayout()->createBlock('catalog/product_list_toolbar')->getLimit())->setCollection($prodCol);
    $linkPrev = false;
    $linkNext = false;
    if ($tool->getCollection()->getSelectCountSql()) {
        if ($tool->getLastPageNum() > 1) {
            if (!$tool->isFirstPage()) {
                $linkPrev = true;
                if ($tool->getCurrentPage() == 2) {
                    $url = explode('?', $tool->getPreviousPageUrl());
                    $prevUrl = @$url[0];
                }
                else {
                    $prevUrl = $tool->getPreviousPageUrl();
                }
            }
            if (!$tool->isLastPage()) {
                $linkNext = true;
                $nextUrl = $tool->getNextPageUrl();
            }
        }
    }
    if ($linkPrev) echo '<link rel="prev" href="' . $prevUrl . '" />';
    if ($linkNext) echo '<link rel="next" href="' . $nextUrl . '" />';
}
?>


<script type="text/javascript">

    jQuery(document).ready(function($){

        $("#footer-newsletter").on("submit",function(e) {
            var $form    = $(this);
            var postUrl  = $form.prop("action");
            var email    = $form.find("#footer-newsletter-input").val();
            var $msgs    = $form.find("#footer-newsletter-msg").text('&nbsp;').removeClass("error overlay").stop(true,true);

            // Test for Valid Email Address
            if(!(/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9]+[a-zA-Z0-9.-]+[a-zA-Z0-9]+.[a-z]{1,4}$/.test(email))) {
                $msgs.
                    fadeOut(0).
                    text("Invalid Email Address").
                    addClass("error").
                    fadeIn(500, function() {
                        var $this = $(this);
                        setTimeout(function() {
                            $this.fadeOut(500, function() {
                                $this.removeClass("error");
                            });
                        }, 1500);
                    });
                return false;
            }

            $msgs.
                fadeOut(0).
                text("Joining Newsletter...").
                addClass("overlay").
                fadeIn(200);

            var formData = {
                "email": email
            };

            $.ajax({
                url: postUrl,
                method: "POST",
                data: formData,
                success: function() {
                    $msgs.text("Thanks for Joining!");
                },
                error: function() {
                    $msgs.stop().removeClass("overlay").
                        fadeOut(0).
                        text("Error: Try Again").
                        addClass("error").
                        fadeIn(500, function() {
                            var $this = $(this);
                            setTimeout(function() {
                                $this.fadeOut(500, function() {
                                    $this.removeClass("error");
                                });
                            }, 1500);
                        });
                }
            });

            return false;

        });

        if($(".product-tab").length) {
            if($(location.hash).length) {
                $(".product-tab.active").removeClass("active");
                $(location.hash).addClass("active");
            }
            $(".product-tab-title a").on("click", function(ev){
                ev.preventDefault();
                $("#product-tabs").find(".product-tab.active").removeClass("active");
                $(this.hash).addClass("active");
                scrollTop = $(document).scrollTop();
                location.hash = this.hash;
                $(document).scrollTop(scrollTop);
            });
        }

        if($("#category-slider").length) {
            $(".category-slider-nav").on("click", function(e) {
                var $btn = $(this);
                if($btn.hasClass('disabled')) return console.log("disabled")&&false;
                var $oBtn  = $btn.siblings(".category-slider-nav");
                var dir    = $btn.attr("id") == "category-slider-prev" ? 1 : -1;
                var $wrap  = $("#category-slider-inner");
                var $table = $("table", $wrap);
                if(!$table.length) return console.log("no table")&&false;
                var tableW = $table.width();
                var curOff = $table.position().left;
                var dist   = $table.find("td").width();
                if(dir>0) {
                    if((curOff*-1)<dist) return console.log("offset less than dist")&&false;
                } else {
                    if(tableW-$wrap.width()-(curOff*dir) < 0) return false;
                }
                var newLeft = "+=" + (dir*dist);
                $table.animate({
                    left: newLeft
                },{
                    duration: 400
                });
                if((curOff<dist)||(tableW-$wrap.width()-(curOff*dir) < 0)) {
                    $btn.addClass("disabled");
                    $oBtn.removeClass("disabled");
                } else {
                    $btn.removeClass("disabled");
                }
            });
        }

        if(location.pathname.match(/^\/$/)) {
            if(jQuery(".home-slide").length>=3) {
                jQuery.homeSlider = function() {
                    jQuery.homeSlider.slide = function() {
                        this.deferred   = jQuery.Deferred();
                        var $_def_current   = jQuery.Deferred();
                        var $_def_next      = jQuery.Deferred();
                        var $_slides        = jQuery('.home-slide');
                        var $_slide_current = $_slides.filter(".current");
                        var $_slide_next    = $_slides.filter(".next");
                        var $_new_next      = $_slide_next.next();
                            $_new_next      = !!$_new_next.length ? $_new_next : $_slides.first();
                        var $_slide_prev    = $_slides.filter(".prev");
                        $_slide_current.fadeOut(
                            "slow",
                            function() {
                                jQuery(this).
                                    addClass("prev").
                                    removeClass("current");
                                $_def_current.resolve();
                            }
                        );
                        $_slide_next.fadeIn(
                            "slow",
                            function(){
                                jQuery(this).
                                    addClass("current").
                                    removeClass("next");
                                $_def_next.resolve();
                            }
                        );
                        $_slide_prev.removeClass("prev");
                        $_new_next.addClass("next").removeClass("prev current");
                        jQuery.when($_def_current, $_def_next).done(this.deferred.resolve);

                    };
                    jQuery.homeSlider.deferred  = null;
                    jQuery.homeSlider.timeout   = 5000;
                    jQuery.homeSlider.stop      = function() {
                        clearTimeout(jQuery.homeSlider.To);
                    };
                    jQuery.homeSlider.ToFunc    = function() {
                        jQuery.homeSlider.slide();
                        jQuery.when(jQuery.homeSlider.deferred).done(function() {
                            clearTimeout(jQuery.homeSlider.To);
                            jQuery.homeSlider.To = setTimeout(jQuery.homeSlider.ToFunc,jQuery.homeSlider.timeout);
                        });
                    };
                    jQuery.homeSlider.To = setTimeout(jQuery.homeSlider.ToFunc,jQuery.homeSlider.timeout);
                };
                jQuery.homeSlider();
            }
        }
        if(location.href.match(/products/)) {
            jQuery(".product-details-options-color-swatch").bind("click", function(e) {
                var $this       = jQuery(this);
                $this.siblings(".selected").removeClass("selected");
                var selection   = $this.data('color');
                var parent      = $this.addClass("selected");
                jQuery("select[name^=options] option").filter(function() {
                    $opt = jQuery(this);
                    toSel = !!($opt.val()==selection);
                    return toSel;
                }).prop('selected', true);
            });
        }
        if(location.href.match(/onepage/)) {
            jQuery.getCreditCardType = function(val) {
                if(!val || !val.length) return undefined;

                switch(val.charAt(0)) {
                    case '4': return 'VISA';
                    case '5': return 'MC';
                    case '3': return 'AMEX';
                    case '6': return 'DISCOVER';
                    default: return 'NN';
                };

                return undefined;
            };

            jQuery.fn.creditCardType = function(options) {
                var settings = {
                    target: '#credit-card-type'
                };

                if(options) {
                    jQuery.extend(settings, options);
                };

                var keyupHandler = function() {
                    var background_position = '0 0';
                    var card_code = "";
                    switch(jQuery.getCreditCardType($(this).val())) {
                        case 'VISA':
                            background_position = '0 -23px';
                            card_code = "VI";
                            break;
                        case 'MC':
                            background_position = '0 -46px';
                            card_code = "MC";
                            break;
                        case 'AMEX':
                            background_position = '0 -69px';
                            card_code = "AE";
                            break;
                        case 'DISCOVER':
                            background_position = '0 -92px';
                            card_code = "DI";
                            break;
                        case 'NN':
                        default:
                            background_position = '0 0';
                            card_code = "NN";
                    };
                    if(card_code!=="") {
                        jQuery(".active",settings.target).removeClass("active");
                        jQuery(settings.target+" ."+card_code).addClass("active");
                        jQuery("select#paypal_direct_cc_type option").filter(function() {
                            return (jQuery(this).val() == card_code);
                        }).prop("selected", true);
                    }
                };

                return this.each(function() {
                    jQuery(this).parent().on('keyup', "input",keyupHandler).trigger('keyup');
                });
            };
            jQuery('#paypal_direct_cc_number').creditCardType();
        }
    });
    //<![CDATA[
    var BLANK_URL = '<?php echo $this->helper('core/js')->getJsUrl('blank.html') ?>';
    var BLANK_IMG = '<?php echo $this->helper('core/js')->getJsUrl('spacer.gif') ?>';
    //]]>
</script>




